<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.starbucks.dao.OrderDao">

    <select id="findNearestStores" resultType="com.example.starbucks.dto.StoreDto">
        SELECT
            id,
            store_name,
            x,
            y,
            store_type,
            store_addr,
            (6371 * acos(
                cos(radians(#{lat}))
                * cos(radians(y))
                * cos(radians(x) - radians(#{lng}))
                + sin(radians(#{lat})) * sin(radians(y))
            )) AS distance
        FROM starbugs_store
        ORDER BY distance ASC
        LIMIT 20;
    </select>

    <select id="getStoreById" parameterType="int" resultType="com.example.starbucks.dto.StoreDto">
        SELECT
            id, 
            store_name,
            store_addr
        FROM starbugs_store 
        WHERE id = #{id}
    </select>

    <insert id="insertOrder" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO starbugs_order (
            store_id, order_type, order_status
        ) VALUES (
            #{storeId}, #{orderType}, #{orderStatus}
        )
    </insert>

</mapper>